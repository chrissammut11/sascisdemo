<!doctype html> 
<html> 
<head> 
<title>SAS Visual Analytics Custom Data Table version v006</title> 
<script type="text/javascript" src="util/messagingUtil.js"></script> 
<script type="text/javascript" src="util/jobExecutionUtil.js"></script> 
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script> 
<style> 
    body {font-family: AvenirNext, Helvetica, Arial, sans-serif; 
          font-size: .8889rem; 
          background-color: #80b0ef;} 
    table {border-collapse: collapse;} 
    th {text-align: left;} 
    th, td {padding: 0.25rem .5rem;} 
    tbody, tr + tr {border-top: 1px solid rgb(231, 231, 231);} 
    th + th, td + td {border-left: 1px solid rgb(231, 231, 231);} 
    .numeric {text-align: right;} 
    body::-webkit-scrollbar {width: 0.5em;} 
    body::-webkit-scrollbar:horizontal {height: 0.5em;} 
    body::-webkit-scrollbar-thumb {background-color: darkgrey;outline: 1px solid slategrey;} 
    body::-webkit-scrollbar-button {display: none;} 
    #sample {display: block;} 
    .additional-info {width: 100%;padding: 10px;border: 1px solid #ccc;border-radius: 4px;box-sizing: border-box;font-size: 16px;} 
    .spinner {display: none;width: 50px;height: 50px;border: 5px solid #f3f3f3;border-top: 5px solid #3498db;border-radius: 50%;animation: spin 1s linear infinite;} 
    @keyframes spin {0% { transform: rotate(0deg); }25% { transform: rotate(90deg); }50% { transform: rotate(180deg); }75% { transform: rotate(270deg); }100% { transform: rotate(360deg); }} 
    .message {display: none;margin-top: 20px;font-size: 18px;color: rgb(0, 128, 11);} 
</style> 
</head> 
<body> 
<BR>This is START of the HTML page VERSION v006 
<div id="instruction"> 
</div><div id="sample"></div> 
<form id="myForm"> 
<script> 
    var sampleData = {data:[["Canada","North America",6]]}; 
    /* EVENT HANDLERS */ 
    var self = this; 
    var sampleColumnInfo = [{label: "Country", type: "string"},{label: "Region", type: "string"},{label: "Happiness Rank", type: "number"}]; 
    // Retrieve data and begin processing 
    function onMessage(evt) { 
        if (evt & evt.data) { 
            var results = null; 
            var columnInfo = null; 
            self.resultName = evt.data.resultName; 
 
            if (evt.data.availableRowCount >= 0) { 
                results = evt.data; 
                columnInfo = evt.data.columns; 
 
//Add any input/select columns here starting with bi901 
 evt.data.columns.push({"name":"bi901","label":"Notes","type":"string","class":"additional-info"});                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 evt.data.columns.push({"name":"bi902","label":"Risk Status","type":"string"});                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 evt.data.columns.push({"name":"bi903","label":"Preferred Language","type":"string"});                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 evt.data.columns.push({"name":"bi904","label":"Submission Date","type":"date"});                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
            } 
            else if (evt.data.availableRowCount == -1) { 
                results = sampleData; 
                columnInfo = sampleColumnInfo; 
            } 
 
            if(results) { 
                jsonToTable(columnInfo, results.data); 
            } 
        } 
    } 
 
    if (window.addEventListener) { 
        // For standards-compliant web browsers 
        window.addEventListener("message", onMessage, false); 
    } else { 
        window.attachEvent("onmessage", onMessage); 
    } 
    // Update the object's selection when a row is checked/unchecked 
    function sendSelection(evt) { 
        var selectedRows = document.querySelectorAll(':checked'); 
        var selection = []; 
        for (var i = 0; i < selectedRows.length; i++) 
        { 
            var row = selectedRows[i]; 
            selection.push({row: row.id}); 
        } 
 
        var message = { 
            resultName: self.resultName, 
            selections: selection 
        }; 
 
        sendMessage(message); 
    } 
    function sendMessage(message) 
    { 
        var url = (window.location != window.parent.location) 
            ? document.referrer 
            : document.location.href; 
 
        window.parent.postMessage(message, url); 
    } 
    /*  TABLE CREATION  */ 
    // Create an HTML DOM element of the given type containing the given text 
    function createElementWithText(element, text) { 
        var e = document.createElement(element); 
        e.appendChild(document.createTextNode(text)); 
        return e; 
    } 
 
    // Process the array of CSV data and create a table 
    function jsonToTable(columnInfo, jsonData) { 
 
        // Create table 
        var tableDivId = 'sample'; // identifier for the tables parent/container 
        var tableDiv = document.getElementById(tableDivId); 
 
        // If a table already exists in our custom div, remove it 
        tableDiv.innerHTML = ""; 
 
        var table = tableDiv.appendChild(document.createElement('table')); 
        var lastColumnIsSelectionData = false; 
        // Create headers from column info 
        addHeaderRow(columnInfo.filter(function (c) { 
            if (c.usage == "brush") { 
                lastColumnIsSelectionData = true; 
                return false; 
            } 
            return true; 
        }).map(function (c) { 
            return c.label; 
        })); 
 
        // Create table body for incoming data 
        var tableBody = table.appendChild(document.createElement('tbody')); 
 
        // Add remaining rows to table body 
        if (jsonData) { 
            for (var i = 0; i < jsonData.length; i++) { 
                addDataRow(jsonData[i], lastColumnIsSelectionData); 
            } 
        } 
 
        // Append a header row to the table 
        function addHeaderRow(columnLabels) { 
            // Create table row 
            var tableHead = document.createElement('thead'); 
            var tr = document.createElement('tr'); 
 
            // Add a blank cell for checkbox/selection column 
            tr.appendChild(document.createElement('th')); 
 
            // Add a header cell for each column heading 
            columnLabels.forEach(function (header) { 
                tr.appendChild(createElementWithText('th', header)); 
            }); 
            tr.appendChild(document.createElement('th')); 
 
            tableHead.appendChild(tr); 
            table.appendChild(tableHead); 
        } 
 
        // Append a data row to the table 
        function addDataRow(dataFields, lastColumnIsSelectionData) { 
            addDataRow.rowNum = ++addDataRow.rowNum || 0; 
            var tr = document.createElement('tr'); 
 
            // Add a checkbox/selector with ID to each row 
            var checkbox = document.createElement('input'); 
            checkbox.type = 'checkbox'; 
            checkbox.setAttribute('id', addDataRow.rowNum); 
            checkbox.setAttribute('class', 'row-select'); 
            checkbox.addEventListener('click', sendSelection); 
            checkbox.checked = true; 
 
            var checkboxCell = document.createElement('td'); 
            checkboxCell.appendChild(checkbox); 
            tr.appendChild(checkboxCell); 
 
            // Add table cell for each data field 
            dataFields.forEach(function (field, index) { 
                if (lastColumnIsSelectionData & index == dataFields.length - 1) { 
                    if (field > 0) 
                        checkbox.checked = true; 
                    return; 
                } 
                var td = createElementWithText('td', field); 
                if (!isNaN(field)) { 
                    td.className = 'numeric'; // Set numeric class to align numeric cells 
                } 
                tr.appendChild(td); 
            }); 
        } 
    } 
</script> 
<BR><BR> 
<button onclick="submitSelections()">Submit Selections</button> 
</form> 
<br><br> 
<div class="spinner" id="spinner"></div> 
<div class="message" id="message2">Job is processing</div> 
<div class="message" id="message">Data processed successfully!</div> 
<BR>This is the END of the HTML page
</body>
</html>
